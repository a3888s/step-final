name: Build and Push Docker Image  # Назва GitHub Workflow

on:
  push:                             # Виконувати Workflow при пушах
    branches:
      - dev                         # Тільки для гілки "dev"

jobs:
  build:
    runs-on: ubuntu-latest          # Виконувати на останній версії Ubuntu
    steps:
      - name: Checkout code         # Крок для завантаження коду репозиторію
        uses: actions/checkout@v3   # Офіційний GitHub Action для checkout

      - name: Login to Docker Hub   # Логін у Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}  # Ім'я користувача з GitHub Secrets
          password: ${{ secrets.DOCKERHUB_TOKEN }}     # Токен з GitHub Secrets

      - name: Build Docker Image    # Побудова Docker-образу
        run: |
          docker build -t ${{ secrets.DOCKERHUB_USERNAME }}/step-final-project:v4.0.1 -f app/Dockerfile app/

      - name: Push Docker Image     # Завантаження Docker-образу в Docker Hub
        run: |
          docker push ${{ secrets.DOCKERHUB_USERNAME }}/step-final-project:v4.0.1
